#!/bin/bash

name=specrun

#find source path
if [ -z "$source_path" ]; then
  source_path=`pwd`
else
  source_path=`cd $source_path; pwd`
fi

spec=spec_cpu_2000

if [ $source_path == `pwd` ]; then
  #make build directory
  build_dir=`pwd`/../$name-build
  #mkdir -p `pwd`/../debug
  mkdir -p $build_dir
  config_host_mak="$source_path/config-host.mak"
  config_mak="$build_dir/config.mak"
  config_host_pm="$source_path/misc/config_host.pm"
  #make config-host.mak
  echo "# Automatically generated by configure - do not modify">$config_host_mak
  echo "# Configured with: $0 $@" >> $config_host_mak
  echo "NAME=$name" >> $config_host_mak
  echo "SRCDIR=$source_path" >> $config_host_mak
  echo "build=\$(abspath $build_dir)" >> $config_host_mak
  echo "SPEC=$spec"     >> $config_host_mak
 
  echo "include $source_path/config-host.mak" > $config_mak

  #make config-host.h
  config_host_h="$source_path/config-host.h"
  echo "// Automatically generated by configure - do not modify">$config_host_h
  echo "// Configured with: $0 $@" >> $config_host_h
  echo "#ifndef __CONFIG_HOST_H" >> $config_host_h
  echo "#define __CONFIG_HOST_H" >> $config_host_h
  echo "#define SRCDIR \"$source_path\"" >> $config_host_h
  echo "#define BUILD_DIR \"$build_dir\"" >> $config_host_h
  echo "#endif" >> $config_host_h
  #make misc/config_host.pm
  echo "our \$srcdir = \"$source_path\";" > $config_host_pm
else
  build_dir=`pwd`
fi

echo "1;" >> $config_host_pm;
